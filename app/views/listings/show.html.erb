<% property = Rubillow::HomeValuation.zestimate({ zpid: @listing.zpid }) %>
<% deep_search_results = Rubillow::PropertyDetails.deep_search_results({ address: @listing.address, citystatezip: @listing.citystatezip }) %>
<% rillow = Rillow.new('X1-ZWz1frh4ucm4nf_8l13j') %>
<% result = rillow.get_updated_property_details(@listing.zpid) %>




<div class="container">
  <div class="header-row listings-show">
    <h1><%= @listing.address %></h1>
    <h3><%= @listing.location %>, <%= @listing.status %></h3>
    <div class="row">
      <%= image_tag result.to_hash['response'].first['images'].first['image'].first['url'].first, class: "fancy-border" %>
    </div> <!-- img row -->
    <p>Zillow Property ID: <%= link_to deep_search_results.links[:homedetails] do %><span class="linkish"><%= @listing.zpid %></span><% end %></p>
  </div> <!-- header row -->

  <div class="card no-hover full-width property-details">
    <div class="row">

      <div class="status-box">
        <% if current_user && current_user.admin %>
          <%= link_to edit_listing_path(@listing) do %>
            <i class="icon ion-edit"></i>
          <% end %>
          <%= link_to @listing, method: :delete, data: { confirm: 'Are you sure?' } do %>
            <i class="icon ion-trash-a"></i>
          <% end %>
        <% end %>
      </div>

      <div class="col-xs-12">
        <h3 style="color: green">Zestimate: <%= number_to_currency(property.price) %></h3>
        <p><%= deep_search_results.finished_square_feet %> Square Feet, <%= pluralize(deep_search_results.bedrooms, "Bedroom") %>, <%= pluralize(deep_search_results.bathrooms, "Bathroom") %></p>
        <p><em><%= @listing.notes %></em></p>
    </div> <!-- col -->

    </div> <!-- row -->
  </div> <!-- fancy border -->

  <h3 class="text-center"><%= link_to 'Edit', edit_listing_path(@listing) %> | <%= link_to 'Back', listings_path %>
</div> <!-- container -->
